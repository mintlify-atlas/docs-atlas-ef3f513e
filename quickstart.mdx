---
title: Quick Start
description: Build your first embedded filesystem with Broccoli in 5 minutes
---

# Quick Start

This guide walks you through creating a simple web server that serves static files embedded in your Go binary using Broccoli.

## What You'll Build

A web server that serves HTML, CSS, and JavaScript files from an embedded virtual filesystemâ€”no external files needed at runtime!

## Prerequisites

- [Broccoli installed](/installation) on your system
- Basic familiarity with Go

## Tutorial

<Steps>
  <Step title="Create a new Go project">
    Initialize a new Go module:

    ```bash
    mkdir broccoli-demo
    cd broccoli-demo
    go mod init example.com/broccoli-demo
    ```
  </Step>

  <Step title="Install Broccoli dependencies">
    Add the Broccoli filesystem library:

    ```bash
    go get aletheia.icu/broccoli/fs
    ```

    This installs the runtime library for accessing embedded files.
  </Step>

  <Step title="Create static files">
    Create a `public` directory with some static assets:

    ```bash
    mkdir public
    ```

    Create `public/index.html`:

    ```html
    <!DOCTYPE html>
    <html>
    <head>
        <title>Broccoli Demo</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <h1>Hello from Broccoli!</h1>
        <p>These files are embedded in the binary.</p>
        <script src="app.js"></script>
    </body>
    </html>
    ```

    Create `public/styles.css`:

    ```css
    body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }
    ```

    Create `public/app.js`:

    ```javascript
    console.log('JavaScript loaded from embedded filesystem!');
    document.addEventListener('DOMContentLoaded', () => {
        console.log('Page ready!');
    });
    ```
  </Step>

  <Step title="Create the Go application">
    Create `main.go` with the following content:

    ```go
    package main

    //go:generate broccoli -src=public -o assets

    import (
        "fmt"
        "net/http"
        "os"
    )

    func main() {
        // Enable development mode if not in production
        if os.Getenv("PRODUCTION") == "" {
            assets.Development(true)
            fmt.Println("Running in development mode (using local files)")
        }

        // Create HTTP handler for embedded files
        handler := assets.Serve("public")

        // Start the server
        addr := ":8080"
        fmt.Printf("Server starting on http://localhost%s\n", addr)
        if err := http.ListenAndServe(addr, handler); err != nil {
            fmt.Fprintf(os.Stderr, "Server error: %v\n", err)
            os.Exit(1)
        }
    }
    ```

    <Note>
      The `//go:generate` directive tells Go to run `broccoli` when you execute `go generate`. The `-src=public` flag specifies the source directory, and `-o assets` names the output file (will be `assets.gen.go`).
    </Note>
  </Step>

  <Step title="Generate the embedded filesystem">
    Run `go generate` to create the embedded filesystem:

    ```bash
    go generate
    ```

    This creates `assets.gen.go` containing your compressed files. The file looks like this:

    ```go
    // Code generated by broccoli at 2024-01-15T10:30:00Z.
    package main

    import "aletheia.icu/broccoli/fs"

    var assets = fs.New(false, []byte("...compressed data..."))
    ```

    <Tip>
      The `assets` variable is now available in your code and provides access to all embedded files.
    </Tip>
  </Step>

  <Step title="Build and run">
    Build your application:

    ```bash
    go build
    ```

    Run the binary:

    ```bash
    ./broccoli-demo
    ```

    Open your browser to `http://localhost:8080` and see your embedded website!

    <Note>
      The binary includes all your static files. You can delete the `public/` directory and the server will still work!
    </Note>
  </Step>
</Steps>

## Testing the Embedded Filesystem

Let's verify that files are truly embedded:

<Steps>
  <Step title="Test with local files">
    First, run in development mode (default):

    ```bash
    ./broccoli-demo
    ```

    Visit `http://localhost:8080` and verify the page loads.
  </Step>

  <Step title="Move the source directory">
    Rename the public directory:

    ```bash
    mv public public.backup
    ```
  </Step>

  <Step title="Run in production mode">
    Set the `PRODUCTION` environment variable and run again:

    ```bash
    PRODUCTION=1 ./broccoli-demo
    ```

    The server still works! Files are being served from the embedded filesystem.
  </Step>

  <Step title="Restore the directory">
    ```bash
    mv public.backup public
    ```
  </Step>
</Steps>

## Using the Broccoli API

Beyond serving files over HTTP, you can interact with the embedded filesystem directly:

### Opening Files

```go
file, err := assets.Open("public/index.html")
if err != nil {
    log.Fatal(err)
}
defer file.Close()

content, err := io.ReadAll(file)
if err != nil {
    log.Fatal(err)
}

fmt.Println(string(content))
```

### Getting File Info

```go
info, err := assets.Stat("public/styles.css")
if err != nil {
    log.Fatal(err)
}

fmt.Printf("File: %s, Size: %d bytes\n", info.Name(), info.Size())
```

### Walking the Filesystem

```go
err := assets.Walk("public", func(path string, info os.FileInfo, err error) error {
    if err != nil {
        return err
    }
    
    if !info.IsDir() {
        fmt.Printf("%s (%d bytes)\n", path, info.Size())
    }
    
    return nil
})

if err != nil {
    log.Fatal(err)
}
```

## Advanced Configuration

### Bundle Multiple Directories

```go
//go:generate broccoli -src=public,templates,images -o assets
```

Then serve from a specific root:

```go
http.Handle("/static/", assets.Serve("public"))
http.Handle("/templates/", assets.Serve("templates"))
```

### Optimize for Large Bundles

Use lazy decompression to reduce startup time:

```go
//go:generate broccoli -src=public -opt -o assets
```

Files are decompressed only when first accessed, improving startup performance.

### Filter Files with Glob Patterns

Include only web assets:

```go
//go:generate broccoli -src=public -include="*.html,*.css,*.js,*.png,*.jpg" -o assets
```

Exclude development files:

```go
//go:generate broccoli -src=public -exclude="*.map,*.ts" -o assets
```

### Respect .gitignore

Automatically exclude files in your `.gitignore`:

```go
//go:generate broccoli -src=public -gitignore -o assets
```

### Custom Compression Level

Use faster compression for development (level 1-11):

```go
//go:generate broccoli -src=public -quality=6 -o assets
```

Higher quality = better compression but slower build time.

## Complete Example

Here's a more complete example with custom 404 handling:

<CodeGroup>

```go main.go
package main

//go:generate broccoli -src=static -o assets -var staticFiles

import (
    "fmt"
    "log"
    "net/http"
    "os"
)

func main() {
    // Development mode toggle
    if os.Getenv("DEV") != "" {
        staticFiles.Development(true)
        log.Println("Development mode: using local files")
    }

    // Custom handler with 404 support
    mux := http.NewServeMux()
    
    // Serve static files
    mux.Handle("/", customHandler(staticFiles.Serve("static")))
    
    // API endpoint
    mux.HandleFunc("/api/health", func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set("Content-Type", "application/json")
        fmt.Fprint(w, `{"status":"ok"}`)
    })

    log.Println("Server listening on :8080")
    log.Fatal(http.ListenAndServe(":8080", mux))
}

func customHandler(h http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        // Try to serve the file
        h.ServeHTTP(w, r)
    })
}
```

```html static/index.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broccoli App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main>
        <h1>ðŸ¥¦ Broccoli Demo</h1>
        <p>Serving static files from an embedded filesystem!</p>
        <button id="testBtn">Test API</button>
        <pre id="output"></pre>
    </main>
    <script src="app.js"></script>
</body>
</html>
```

```javascript static/app.js
document.getElementById('testBtn').addEventListener('click', async () => {
    const response = await fetch('/api/health');
    const data = await response.json();
    document.getElementById('output').textContent = JSON.stringify(data, null, 2);
});
```

```css static/styles.css
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: system-ui, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

main {
    background: rgba(255, 255, 255, 0.1);
    padding: 3rem;
    border-radius: 1rem;
    backdrop-filter: blur(10px);
    max-width: 600px;
}

button {
    margin-top: 1rem;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    background: white;
    color: #764ba2;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    font-weight: 600;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

pre {
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 0.5rem;
    overflow-x: auto;
}
```

</CodeGroup>

Build and run:

```bash
go generate
go build
./broccoli-demo
```

## Next Steps

<CardGroup cols={2}>
  <Card title="API Reference" icon="book" href="https://godoc.org/aletheia.icu/broccoli/fs">
    Explore the complete API documentation on GoDoc
  </Card>
  
  <Card title="Examples" icon="code" href="https://vcs.aletheia.icu/lads/broccoli">
    View more examples in the Broccoli repository
  </Card>
</CardGroup>

## Common Patterns

### SPA (Single Page Application) Support

Serve `index.html` for all routes:

```go
func spaHandler(staticFS http.Handler) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // Try to open the file
        f, err := assets.Open("public" + r.URL.Path)
        if err != nil {
            // File not found, serve index.html for SPA routing
            r.URL.Path = "/"
        } else {
            f.Close()
        }
        staticFS.ServeHTTP(w, r)
    }
}

http.HandleFunc("/", spaHandler(assets.Serve("public")))
```

### Cache-Control Headers

Add caching headers for better performance:

```go
func withCaching(h http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set("Cache-Control", "public, max-age=31536000")
        h.ServeHTTP(w, r)
    })
}

http.Handle("/", withCaching(assets.Serve("public")))
```

### Content Security Policy

Add security headers:

```go
func withCSP(h http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set("Content-Security-Policy", "default-src 'self'")
        w.Header().Set("X-Content-Type-Options", "nosniff")
        w.Header().Set("X-Frame-Options", "DENY")
        h.ServeHTTP(w, r)
    })
}

http.Handle("/", withCSP(assets.Serve("public")))
```

<Tip>
  Remember to run `go generate` whenever you modify files in your source directory!
</Tip>

## Summary

You've learned how to:

- âœ… Install and configure Broccoli
- âœ… Create a `go:generate` directive
- âœ… Generate an embedded filesystem
- âœ… Serve files over HTTP
- âœ… Use development mode for rapid iteration
- âœ… Access files directly through the API
- âœ… Apply advanced configurations

Your static files are now embedded in your Go binary with superior brotli compression!
