---
title: "Broccoli"
description: "The Broccoli type provides a virtual file system for brotli-compressed assets"
---

## Overview

The `Broccoli` type is a virtual file system of brotli-compressed assets. It is generated by the broccoli tool and provides methods for accessing embedded files.

## Type Definition

```go
type Broccoli struct {
    files     map[string]*File
    filePaths []string
    devMode   bool
}
```

<Note>
  The Broccoli object is generated by the broccoli tool using:
  ```go
  //go:generate broccoli src=asset1,asset2... -o filename -var br
  ```
</Note>

## Methods

### Open

Opens the named file for reading. If successful, methods on the returned file can be used for reading.

```go
func (br *Broccoli) Open(path string) (http.File, error)
```

<ParamField path="path" type="string" required>
  The path to the file to open. The path is normalized automatically (leading `./` and `/` are removed).
</ParamField>

<ResponseField name="http.File" type="http.File">
  The opened file that implements the http.File interface.
</ResponseField>

<ResponseField name="error" type="error">
  Returns `os.ErrNotExist` if the file is not found, or an error if the file cannot be opened.
</ResponseField>

**Example:**

```go
file, err := br.Open("assets/style.css")
if err != nil {
    log.Fatal(err)
}
defer file.Close()

// Read file contents
data, _ := io.ReadAll(file)
```

<Note>
  In development mode, `Open` will access the local file system instead of the bundled files.
</Note>

---

### Stat

Returns a FileInfo describing the named file.

```go
func (br *Broccoli) Stat(path string) (os.FileInfo, error)
```

<ParamField path="path" type="string" required>
  The path to the file. The path is normalized automatically.
</ParamField>

<ResponseField name="os.FileInfo" type="os.FileInfo">
  File information including name, size, mode, and modification time.
</ResponseField>

<ResponseField name="error" type="error">
  Returns `os.ErrNotExist` if the file is not found.
</ResponseField>

**Example:**

```go
info, err := br.Stat("assets/logo.png")
if err != nil {
    log.Fatal(err)
}
fmt.Printf("Size: %d bytes\n", info.Size())
fmt.Printf("Modified: %v\n", info.ModTime())
```

---

### Walk

Walks the file tree rooted at root, calling walkFn for each file or directory in the tree, including root.

```go
func (br *Broccoli) Walk(root string, walkFn filepath.WalkFunc) error
```

<ParamField path="root" type="string" required>
  The root path to start walking from.
</ParamField>

<ParamField path="walkFn" type="filepath.WalkFunc" required>
  A function called for each file or directory. The function signature is:
  ```go
  func(path string, info os.FileInfo, err error) error
  ```
</ParamField>

<ResponseField name="error" type="error">
  Returns an error if the walk function returns an error.
</ResponseField>

<Note>
  - Files are walked in lexical order, making the output deterministic
  - Walk does not follow symbolic links
  - All errors that arise visiting files and directories are filtered by walkFn
</Note>

**Example:**

```go
err := br.Walk("assets", func(path string, info os.FileInfo, err error) error {
    if err != nil {
        return err
    }
    fmt.Printf("Path: %s, Size: %d\n", path, info.Size())
    return nil
})
if err != nil {
    log.Fatal(err)
}
```

---

### Development

Controls the development mode. If enabled, broccoli will use the local file system instead of the bundled set of files.

```go
func (br *Broccoli) Development(mode bool)
```

<ParamField path="mode" type="bool" required>
  Set to `true` to enable development mode, `false` to use bundled files.
</ParamField>

<Note>
  Development mode is useful during rapid development cycles when the local file system is available or when you don't need to test the bundled content.
</Note>

**Example:**

```go
if os.Getenv("PRODUCTION") == "" {
    br.Development(true)
}
```

---

### Serve

Returns a Server wrapper with specified directory prefix, which can be used as http.Handler.

```go
func (br *Broccoli) Serve(dir string) http.Handler
```

<ParamField path="dir" type="string" required>
  The directory prefix to serve files from. Slashes are automatically trimmed.
</ParamField>

<ResponseField name="http.Handler" type="http.Handler">
  An HTTP handler that serves files from the virtual file system.
</ResponseField>

**Example:**

```go
http.ListenAndServe(":80", br.Serve("public"))
```

See the [Server documentation](/api/serve) for more details on the Server type.